# 📚 문서 정렬 및 관리 가이드

## 📋 문서 정렬 규칙

`docs_ald.json`의 문서는 다음 규칙에 따라 자동으로 정렬됩니다:

### 1. 키워드 개수별 정렬

문서는 먼저 키워드 개수에 따라 그룹화됩니다:

- **1개 키워드** → **2개 키워드** → **3개 키워드** → **4개 이상**

### 2. 키워드 종류별 정렬 (같은 개수 내)

같은 키워드 개수를 가진 문서들은 키워드 종류에 따라 정렬됩니다:

- 키워드를 **알파벳/한글 순서**로 정렬
- 모든 키워드를 고려하여 정렬 (첫 번째, 두 번째, ...)

**예시:**
```
["ALD", "Precursor"]  →  ["ALD", "Purge"]  →  ["MFC", "Flow"]
```

### 3. 텍스트별 정렬

키워드가 완전히 동일한 경우, 텍스트 내용으로 정렬됩니다.

---

## 📊 정렬 결과 예시

현재 문서 구조:

```
ID 1-36:   1개 키워드 (36개)
  - ALD, Flow, MFC, Precursor, Pressure, Purge, ...

ID 37-84:  2개 키워드 (48개)
  - ALD+Precursor, ALD+Purge, MFC+Flow, ...

ID 85-170: 3개 키워드 (86개)
  - 플라즈마+압력+챔버, ...

ID 171+:   4개 이상 키워드 (11개)
```

---

## 🔄 자동 정렬 적용 시점

### 1. `reorganize_docs.py` 실행 시

전체 문서를 재정렬하고 ID를 재할당합니다.

```bash
python scripts/doc_management/merge_docs.py
```

**실행 결과:**
- 키워드 개수별로 그룹화
- 각 그룹 내에서 키워드 종류별 정렬
- ID 1부터 순차적으로 재할당
- 백업 파일 자동 생성

### 2. `merge_docs.py` 실행 시

새 문서를 추가한 후 자동으로 정렬됩니다.

```bash
python scripts/doc_management/merge_docs.py
```

**실행 과정:**
1. 중복 문서 체크
2. 새 문서를 키워드 개수별 그룹에 추가
3. 전체 문서 재정렬
4. ID 재할당

---

## 🛠️ 문서 관리 스크립트 (통합)

### `merge_docs.py` - 통합 문서 관리 스크립트

**모든 문서 관리 기능을 하나로 통합한 스크립트입니다.**

**주요 기능:**
1. **중복 제거**: 기존 문서 내 중복 + 새 문서 vs 기존 문서 중복 체크
2. **정렬**: 키워드 개수별, 종류별 자동 정렬
3. **ID 재할당**: 정렬 후 ID를 1부터 순차적으로 재할당
4. **새 문서 추가**: 선택적으로 새 문서 추가 가능

**사용 방법:**

#### 1. 정렬만 수행 (중복 제거 포함)

`NEW_DOCS`를 빈 리스트로 두고 실행:

```bash
python scripts/doc_management/merge_docs.py
```

**실행 예시:**
```bash
$ python scripts/doc_management/merge_docs.py

📄 기존 문서 수: 180
🔍 기존 문서 내 중복 검사 중...
✅ 기존 문서 내 중복 없음
ℹ️  추가할 새 문서 없음 (정렬만 수행)
------------------------------------------------------------
💾 기존 백업을 backup2로 이동
💾 현재 파일을 백업으로 저장: docs/docs_ald.json.backup
------------------------------------------------------------
✅ 완료!
   총 문서 수: 180개

📋 키워드 개수별 분류:
   1개 키워드: ID 1 ~ 36 (36개)
   2개 키워드: ID 37 ~ 84 (48개)
   3개 키워드: ID 85 ~ 169 (85개)
   4개 키워드: ID 170 ~ 180 (11개)
```

#### 2. 새 문서 추가

`merge_docs.py` 파일의 `NEW_DOCS` 리스트에 문서를 추가하고 실행:

```python
# merge_docs.py 파일 내
NEW_DOCS = [
    {
        "id": 1,  # id는 무시됨 (자동 할당)
        "keywords": ["ALD"],
        "text": "새로운 문서 내용"
    },
]
```

**실행 예시:**
```bash
$ python scripts/doc_management/merge_docs.py

📄 기존 문서 수: 180
🔍 기존 문서 내 중복 검사 중...
✅ 기존 문서 내 중복 없음
➕ 추가할 새 문서 수: 5
------------------------------------------------------------
✅ 1개 키워드 문서 3개 추가 예정
✅ 2개 키워드 문서 2개 추가 예정
✅ 추가됨: ID 37, 키워드: ['ALD']
   텍스트: 새로운 문서 내용...
------------------------------------------------------------
💾 백업 저장: docs/docs_ald.json.backup
------------------------------------------------------------
✅ 완료!
   추가된 문서: 5개
   건너뛴 문서: 0개
   총 문서 수: 185개

📋 키워드 개수별 분류:
   1개 키워드: ID 1 ~ 39 (39개)
   2개 키워드: ID 40 ~ 89 (50개)
   3개 키워드: ID 90 ~ 174 (85개)
   4개 키워드: ID 175 ~ 185 (11개)
```

새 문서를 중복 없이 추가하고 자동으로 정렬합니다.

**사용 시나리오:**
- 여러 문서를 한 번에 추가하고 싶은 경우
- 중복 체크와 함께 문서를 추가하고 싶은 경우

**실행 예시:**
```bash
$ python scripts/doc_management/merge_docs.py

📄 기존 문서 수: 181
➕ 추가할 문서 수: 10
------------------------------------------------------------
✅ 3개 키워드 문서 10개 추가 예정
✅ 추가됨: ID 142, 키워드: ['플라즈마', '압력', '챔버']
   텍스트: 플라즈마 공정에서 챔버 압력이 불안정하면...
------------------------------------------------------------
💾 백업 저장: docs/docs_ald.json.backup
------------------------------------------------------------
✅ 완료!
   추가된 문서: 10개
   건너뛴 문서: 0개
   총 문서 수: 191개

📋 키워드 개수별 분류:
   1개 키워드: ID 1 ~ 36 (36개)
   2개 키워드: ID 37 ~ 84 (48개)
   3개 키워드: ID 85 ~ 180 (96개)
   4개 키워드: ID 181 ~ 191 (11개)
```

---

## 💡 팁

### 문서 ID로 키워드 개수 파악하기

정렬 규칙 덕분에 ID만 봐도 키워드 개수를 알 수 있습니다:

- **ID 1-36**: 1개 키워드
- **ID 37-84**: 2개 키워드
- **ID 85-170**: 3개 키워드
- **ID 171+**: 4개 이상 키워드

### 정렬이 깨진 경우

문서를 수동으로 편집하거나 다른 도구로 수정한 경우, 정렬이 깨질 수 있습니다. 이 경우:

```bash
python scripts/doc_management/merge_docs.py
```

를 실행하여 전체 문서를 재정렬하세요.

### 백업 파일

모든 정렬 작업은 자동으로 백업 파일을 생성합니다:

- `docs_ald.json.backup`: 최신 백업
- `docs_ald.json.backup2`: 이전 백업 (있을 경우)

---

## 📝 관련 문서

- [데이터 수집 가이드](README_DATA_COLLECTION.md)
- [데이터 생성 가이드](README_DATA_GENERATION.md)

