# 하이브리드 검색 및 피드백 루프 기능

## 구현된 기능

### 1. 하이브리드 검색 (Hybrid Search)
- **키워드 매칭 + 의미 기반 검색** 결합
- 의미 기반 검색(임베딩)과 키워드 매칭 점수를 결합하여 더 정확한 검색 결과 제공
- `hybrid_weight` 파라미터로 두 방식의 가중치 조절 (기본값: 0.3)

#### 특징
- **동의어 인식**: 플라즈마 ≈ Plasma, 압력 ≈ Pressure 등
- **키워드 매칭 점수**:
  - 정확한 키워드 매칭: 1.0
  - 동의어 매칭: 0.8
  - 부분 매칭: 0.5

### 2. 동의어 매핑 시스템
- `synonyms.json` 파일에 동의어 그룹 정의
- 자동으로 동의어를 인식하여 검색

예시:
```json
{
  "synonym_groups": [
    ["플라즈마", "Plasma", "plasma", "플라즈마 ALD"],
    ["압력", "Pressure", "pressure"],
    ["챔버", "Chamber", "chamber"],
    ...
  ]
}
```

### 3. 피드백 루프 시스템
- **사용자 평가 수집**: 👍/👎 버튼으로 피드백 수집
- **피드백 데이터 저장**: `feedback_data.json`에 저장
- **세션 추적**: 각 질문/답변에 고유 세션 ID 부여

#### 백엔드 엔드포인트
- `POST /feedback`: 피드백 제출
- `GET /feedback/stats`: 피드백 통계 조회

#### 피드백 데이터 구조
```json
{
  "session_id": "abc123",
  "question": "플라즈마는 무엇인가요?",
  "answer": "...",
  "contexts": [...],
  "feedback": "like" | "dislike",
  "comment": "선택적 코멘트",
  "timestamp": "2024-01-01T12:00:00"
}
```

## 사용 방법

### 하이브리드 검색
- 기본적으로 자동으로 하이브리드 검색이 활성화됩니다.
- `rag_core.py`의 `retrieve()` 함수에 `hybrid_weight` 파라미터로 조절 가능합니다.

### 동의어 추가
`synonyms.json` 파일을 수정하여 동의어 그룹을 추가할 수 있습니다.

### 피드백 제출
1. 프론트엔드에서 질문을 보내고 답변을 받습니다.
2. 답변 아래 👍/👎 버튼을 클릭합니다.
3. 피드백이 자동으로 저장됩니다.

## 피드백 기반 검색 점수 조정 (구현 완료)
- **자동 점수 조정**: 피드백이 좋은 문서는 점수 증가 (+0.2까지), 나쁜 문서는 감소 (-0.2까지)
- **실시간 반영**: 피드백 제출 시 즉시 검색 점수에 반영
- **누적 효과**: 여러 피드백을 누적하여 점수 조정
- **정규화**: 최대 ±0.2 범위로 제한하여 안정성 유지

### 작동 방식
1. 사용자가 👍/👎 피드백 제출
2. 해당 피드백의 컨텍스트 문서들을 식별
3. 좋은 피드백(👍): 문서 점수 증가
4. 나쁜 피드백(👎): 문서 점수 감소
5. 다음 검색부터 조정된 점수가 적용됨

## 향후 개선 사항
1. **자동 동의어 학습**: 피드백에서 자주 같이 나타나는 키워드를 자동으로 동의어로 학습
2. **피드백 기반 재학습**: 피드백 데이터를 활용한 모델 파인튜닝
3. **질문별 피드백 가중치**: 유사한 질문에서의 피드백을 더 많이 반영

## 파일 구조
```
ald-rag-lab/
├── synonyms.json              # 동의어 정의
├── feedback_data.json         # 피드백 데이터 저장
├── rag_core.py               # 하이브리드 검색 로직
└── backend/
    └── app.py                # 피드백 API 엔드포인트
```

